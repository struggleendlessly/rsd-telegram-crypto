@using RazorConsole.Components
@using Spectre.Console

<Panel Title="Add Chat Url" Border="BoxBorder.Rounded" Expand="true">
    <Rows>
		@if (!string.IsNullOrEmpty(_errorMessage))
		{
			<Markup Content="@_errorMessage" Foreground="@Color.Red" Decoration="@Decoration.Bold" />
		}

		<TextInput Label="Url"
				   Value="@_link"
				   ValueChanged="OnLinkChanged"
				   Placeholder="Enter chat link"
				   FocusedBorderColor="@(_isLinkError ? Color.Red : Color.DeepSkyBlue1)"
				   BorderColor="@(_isLinkError ? Color.Red3 : Color.Grey37)"
				   BorderPadding="@_inputPadding"
				   Expand="true" />
		<Columns>
			<TextButton Content="Add"
						OnClick="HandleAddLink"
						BackgroundColor="@Color.Green"
						FocusedColor="@Color.Lime" />
		</Columns>
	</Rows>
</Panel>

@code {
	private static readonly Padding _inputPadding = new(1, 0, 1, 0);
	private string _link = string.Empty;
	private string _errorMessage = string.Empty;
	private bool _isLinkError = false;

	private Task OnLinkChanged(string? value)
	{
		_link = value ?? string.Empty;
		StateHasChanged();
		return Task.CompletedTask;
	}

	private Task HandleAddLink()
	{
		_isLinkError = false;
		_errorMessage = string.Empty;

		if (string.IsNullOrWhiteSpace(_link))
		{
			_isLinkError = true;
			_errorMessage = "Chat url cannot be empty";
			StateHasChanged();
			return Task.CompletedTask;
		}

		_errorMessage = string.Empty;
		_link = string.Empty;
		StateHasChanged();
        return Task.CompletedTask;
    }
}
